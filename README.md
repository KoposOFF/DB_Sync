# Синхронизация Баз Данных 

## Описание проекта

Этот инструмент предназначен для безопасной синхронизации структуры PostgreSQL-базы данных.

Сценарий использования:

* есть тестовая БД (эталонная схема)
* есть боевая БД с данными
* необходимо привести боевую БД к структуре тестовой, не повредив данные

Скрипт анализирует обе базы и:

* находит отсутствующие таблицы
* находит отсутствующие колонки
* формирует SQL-план миграции
* выполняет только безопасные операции:

  * создание таблиц
  * добавление колонок

Изменение типов колонок и удаление таблиц не выполняется автоматически, чтобы избежать потери данных.

---

## Архитектура решения

Класс `DBSync` выполняет следующие шаги:

1. Подключение к двум БД
2. Чтение списка таблиц
3. Сравнение таблиц
4. Чтение структуры колонок
5. Сравнение колонок
6. Генерация SQL-плана миграции
7. Применение изменений в транзакции

Все изменения выполняются только после анализа схем.

---

## Установка и запуск

### 1. Клонировать репозиторий

```bash
git clone git@github.com:KoposOFF/DB_Sync.git
cd db_sync_test
```

### 2. Создать виртуальное окружение

```bash
python3 -m venv venv
source venv/bin/activate
```

### 3. Установить зависимости

```bash
pip install -r requirements.txt
```

---

## Настройка подключения

В файле `main.py` необходимо указать строки подключения:

```python
db1 = "postgresql://user:password@localhost:5432/test_db"
db2 = "postgresql://user:password@localhost:5432/prod_db"
```

---

## Запуск

```bash
python main.py
```

Сначала будет выведен план изменений, затем он будет применён к целевой базе.

---

## Безопасность

Скрипт выполняет только операции, не затрагивающие существующие данные:

* создаёт отсутствующие таблицы
* добавляет новые колонки

Все изменения выполняются в транзакции.
При ошибке происходит rollback.

---


## Автор

Копосов Денис
